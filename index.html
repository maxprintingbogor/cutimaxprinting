<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sistem Cuti Online</title>
<style>
:root{font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
body{max-width:1100px;margin:24px auto;padding:20px;background:#f7fafc;color:#0f172a}
.card{background:white;border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(12,24,40,0.06);margin-top:16px}
form{display:grid;grid-template-columns:1fr 1fr;gap:10px}
label{display:block;font-size:13px;margin-bottom:6px}
input,select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #e6edf3;font-size:14px;background:#fff}
textarea{height:80px;resize:vertical}
.actions{grid-column:1 / -1;display:flex;gap:8px;align-items:center}
button{padding:9px 12px;border-radius:8px;border:0;background:#0ea5ad;color:white;cursor:pointer}
button.ghost{background:transparent;border:1px solid #cbd5e1;color:#0f172a}
.table-wrap{overflow:auto;margin-top:12px}
table{width:100%;border-collapse:separate;border-spacing:0 10px}
thead th{background:transparent;padding:8px;text-align:left;font-size:13px;color:#334155}
tbody tr{background:white;border-radius:8px;box-shadow:0 2px 6px rgba(12,24,40,0.03)}
th,td{padding:12px 10px;border-bottom:0;text-align:left;font-size:14px;vertical-align:middle}
td:first-child, th:first-child{border-top-left-radius:8px;border-bottom-left-radius:8px}
td:last-child, th:last-child{border-top-right-radius:8px;border-bottom-right-radius:8px}
.status{padding:6px 10px;border-radius:999px;font-weight:700;display:inline-block;font-size:13px}
.pending{background:#fff7ed;color:#92400e}
.approved{background:#ecfdf5;color:#065f46}
.rejected{background:#fee2e2;color:#9f1239}
.small-btn{padding:6px 8px;border-radius:8px;border:0;cursor:pointer;margin-right:6px;font-size:13px}
.approve{background:#10b981;color:white}
.reject{background:#ef4444;color:white}
.delete{background:#f43f5e;color:white}
.edit{background:#facc15;color:#08204a}
@media (max-width:900px){ form{grid-template-columns:1fr} .actions{flex-direction:column;align-items:stretch} table{font-size:13px} }
.cal-cell{padding:8px;border-radius:8px;text-align:center;background:#fff;border:1px solid #edf2f7;min-height:44px;display:flex;align-items:center;justify-content:center;margin:2px;}
.cal-today{box-shadow:0 0 0 2px rgba(14,165,173,0.08);border-color:#0ea5ad}
.cal-marked{font-weight:700}
</style>
<!-- Firebase SDK -->
<script type="module">
  // Import Firebase SDK
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, query, where, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-firestore.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-auth.js";

  // TODO: ganti dengan config Firebase-mu
 const firebaseConfig = {
  apiKey: "AIzaSyBVU2VsuFp8X2qxkSglbuKpbODu9d_v9i0",
  authDomain: "sistemcuti-dcc63.firebaseapp.com",
  projectId: "sistemcuti-dcc63",
  storageBucket: "sistemcuti-dcc63.firebasestorage.app",
  messagingSenderId: "410423854240",
  appId: "1:410423854240:web:a7531c304c725253b135c5"
};

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  window.db = db;
  window.auth = auth;
</script>
</head>
<body>

<!-- LOGIN -->
<section class="card" id="loginSection">
  <h2>Login</h2>
  <form id="loginForm">
    <div><label>Email</label><input type="email" id="loginEmail" required></div>
    <div><label>Password</label><input type="password" id="loginPassword" required></div>
    <div class="actions">
      <button type="submit">Login</button>
    </div>
  </form>
  <p>Belum punya akun? <a href="#" id="showRegister">Daftar</a></p>
</section>

<!-- REGISTER -->
<section class="card" id="registerSection" style="display:none">
  <h2>Daftar</h2>
  <form id="registerForm">
    <div><label>Email</label><input type="email" id="regEmail" required></div>
    <div><label>Password</label><input type="password" id="regPassword" required></div>
    <div class="actions"><button type="submit">Daftar</button></div>
  </form>
  <p>Sudah punya akun? <a href="#" id="showLogin">Login</a></p>
</section>

<!-- MAIN -->
<section class="card" id="mainSection" style="display:none">
  <header style="display:flex;align-items:center;gap:12px">
    <h1 style="margin:0">Sistem Cuti</h1>
    <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
      <span id="whoami"></span>
      <button id="logoutBtn" class="ghost">Logout</button>
    </div>
  </header>

  <div id="userSection" style="margin-top:12px">
    <h3>Ajukan Cuti</h3>
    <form id="leaveForm">
      <div><label>Tanggal Mulai</label><input type="date" id="leaveStart" required></div>
      <div><label>Tanggal Selesai</label><input type="date" id="leaveEnd" required></div>
      <div style="grid-column:1/-1"><label>Alasan</label><textarea id="leaveReason"></textarea></div>
      <div class="actions"><button type="submit">Ajukan Cuti</button></div>
    </form>

    <h3>Kalender Pengajuan Cuti (Anda)</h3>
    <div style="display:flex;gap:5px;align-items:center;margin-bottom:5px;">
      <button id="userPrev">←</button>
      <strong id="userCalTitle"></strong>
      <button id="userNext">→</button>
    </div>
    <div id="userCalGrid" style="display:grid;grid-template-columns:repeat(7,1fr);"></div>
  </div>
</section>

<script type="module">
import { db, auth } from window;

const loginForm=document.getElementById('loginForm');
const registerForm=document.getElementById('registerForm');
const leaveForm=document.getElementById('leaveForm');
const loginSection=document.getElementById('loginSection');
const registerSection=document.getElementById('registerSection');
const mainSection=document.getElementById('mainSection');
const whoami=document.getElementById('whoami');
let loggedUser=null;

// NAV LOGIN / REGISTER
document.getElementById('showRegister').onclick=e=>{e.preventDefault(); loginSection.style.display='none'; registerSection.style.display='block';};
document.getElementById('showLogin').onclick=e=>{e.preventDefault(); registerSection.style.display='none'; loginSection.style.display='block';};

// REGISTER
registerForm.onsubmit=async e=>{
  e.preventDefault();
  const email=document.getElementById('regEmail').value;
  const password=document.getElementById('regPassword').value;
  try{
    const cred=await createUserWithEmailAndPassword(auth,email,password);
    alert('Daftar berhasil, silakan login');
    registerSection.style.display='none'; loginSection.style.display='block';
  }catch(err){ alert(err.message); }
};

// LOGIN
loginForm.onsubmit=async e=>{
  e.preventDefault();
  const email=document.getElementById('loginEmail').value;
  const password=document.getElementById('loginPassword').value;
  try{
    const cred=await signInWithEmailAndPassword(auth,email,password);
    loggedUser=cred.user;
    loginSection.style.display='none';
    mainSection.style.display='block';
    whoami.textContent=email;
    renderCalendar();
  }catch(err){ alert(err.message); }
};

// LOGOUT
document.getElementById('logoutBtn').onclick=()=>{ signOut(auth).then(()=>{ location.reload(); }); };

// AJUKAN CUTI
leaveForm.onsubmit=async e=>{
  e.preventDefault();
  const start=document.getElementById('leaveStart').value;
  const end=document.getElementById('leaveEnd').value;
  const reason=document.getElementById('leaveReason').value;
  try{
    await addDoc(collection(db,'leaveRequests'),{userId:loggedUser.uid,start,end,reason,status:'pending'});
    alert('Pengajuan terkirim');
    leaveForm.reset();
    renderCalendar();
  }catch(err){ alert(err.message); }
};

// CALENDAR
const calGrid=document.getElementById('userCalGrid');
const calTitle=document.getElementById('userCalTitle');
let calMonth=new Date().getMonth();
let calYear=new Date().getFullYear();

async function renderCalendar(){
  calGrid.innerHTML='';
  const firstDay=new Date(calYear,calMonth,1).getDay();
  const totalDays=new Date(calYear,calMonth+1,0).getDate();

  // Ambil semua cuti user
  const q=query(collection(db,'leaveRequests'),where('userId','==',loggedUser.uid));
  const snap=await getDocs(q);
  const leaves=[];
  snap.forEach(doc=>{ leaves.push(doc.data()); });

  for(let i=0;i<firstDay;i++){ const div=document.createElement('div'); div.className='cal-cell'; calGrid.appendChild(div); }

  for(let d=1;d<=totalDays;d++){
    const div=document.createElement('div');
    div.className='cal-cell';
    div.textContent=d;
    const thisDate=new Date(calYear,calMonth,d);

    // tandai cuti
    leaves.forEach(l=>{
      const s=new Date(l.start), e=new Date(l.end);
      if(thisDate>=s && thisDate<=e){
        div.classList.add('cal-marked');
        if(l.status==='pending') div.style.background='#fff7ed';
        else if(l.status==='approved') div.style.background='#ecfdf5';
        else if(l.status==='rejected') div.style.background='#fee2e2';
      }
    });
    calGrid.appendChild(div);
  }
  const monthNames=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];
  calTitle.textContent=monthNames[calMonth]+' '+calYear;
}

// NAV CALENDAR
document.getElementById('userPrev').onclick=()=>{ calMonth--; if(calMonth<0){ calMonth=11; calYear--; } renderCalendar(); };
document.getElementById('userNext').onclick=()=>{ calMonth++; if(calMonth>11){ calMonth=0; calYear++; } renderCalendar(); };

</script>
</body>
</html>
